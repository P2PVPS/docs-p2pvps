<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Overview : P2P VPS Documentation</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets_/css/shCore.css">
        <link rel="stylesheet" href="assets_/css/shThemeDefault.css">
        <link rel="stylesheet" href="assets_/css/main.css">
    </head>
    <body>
        <div id="wrapper">
            <div id="content">

<ul id="topnav">
    <li><a href="index.html">Index</a></li>
    <li><a href="#toc">TOC</a></li>
</ul>
<h1 id="overview">Overview</h1>
<p>This document contains the specifications for the Client software. The Client
software is targeted to run on small IoT devices like the Raspberry Pi, and also
desktop computers running a Ubuntu Linux VM in VirtualBox. In this way, the Client
software can turn any computer capable of running Docker into a VPS. That device
can then be rented out on the P2P VPS marketplace.</p>
<p>Client software is defined by the following high-level features:</p>
<ul>
<li>Governor</li>
<li>Docker container with SSH</li>
<li>Persistent Storage<ul>
<li>Encryption</li></ul></li>
<li>Deployment Packages (pre-configured scripts for setting up apps like webservers, file sharing, etc.)</li>
<li>Testing</li>
</ul>
<p>The sections below detail the specifications for each of these features:</p>
<h2 id="tableofcontentsahreftocnametocclassdeeplinka">Table of Contents <a href="#toc" name="toc" class="deep-link">#</a></h2>
<ul>
<li><a href="#Governor-">Governor-()</a></li>
<li><a href="#Docker-Container">Docker-Container</a></li>
<li><a href="#Persistent-Storage">Persistent-Storage</a></li>
<li><a href="#Deployment-Packages">Deployment-Packages</a></li>
<li><a href="#Testing">Testing</a></li>
</ul>
<h2 id="governorp2pvpsclientjsahrefgovernoridgovernorclassdeeplinka">Governor-(p2p-vps-client.js) <a href="#Governor-" id="Governor-" class="deep-link">#</a></h2>
<p>The primary purpose of the governor software is to manage the Docker container and communicate with the
P2P VPS server. This application runs on the host operating system, outside the
Docker container. It plays the following roles:</p>
<ul>
<li>It reads the <code>device-config.json</code> file and registers the Client device with the P2P VPS server.</li>
<li>It builds the Docker container with information returned by the server after registration.</li>
<li>It launches the Docker container after being built.</li>
<li>It sends a heartbeat signal to the P2P VPS server every 10 minutes. The server responds with an expiration date.</li>
<li>When the expiration date is reached, the governor software stops the Docker container and wipes the flash drive.
It then reregisters itself with the P2P VPS server.</li>
</ul>
<p>This workflow diagram illustrates how transactions are initiated and managed:
<img src="images/workflow-thumb.jpg?raw=true" alt="Transaction Worflow" title="Transaction Worflow" /></p>
<p><a href="images/workflow.jpg">Full sized image</a></p>
<h2 id="dockercontainerahrefdockercontaineriddockercontainerclassdeeplinka">Docker-Container <a href="#Docker-Container" id="Docker-Container" class="deep-link">#</a></h2>
<p>A Docker container is generated by the <code>p2p-vps-client.js</code> governor application.
The Owner initiates the creation of the Docker container by registering the device
in the Device Management Dashboard. They are given a GUID, which they
then copy to the file <code>device-config.json</code>. The application <code>p2p-vps-client.js</code>
reads this file and makes a REST API call to the server to register itself.</p>
<p>After a successful registration call, a reverse SSH tunnel to the Docker container is
established. The server returns a computer generated
username, password, and port, which is used to access the Docker container
command line interface (CLI) over an SSH terminal (like <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a>).
Th username, password, and port are passed to the Renter in the <em>Fulfillment</em>
phase of the rental contract purchase, in the OpenBazaar application.</p>
<p>When the contract is terminated, the Docker container is destroyed and all
persistent data wiped.
A new Docker container with new login credentials is generated for the next renter,
and a new listing is added to the P2P VPS OpenBazaar store.</p>
<p>Below is an illustration of the Client software stack:</p>
<p><img src="images/client-software-stack-600px.jpg" alt="Client Software Stack" /></p>
<ul>
<li><p><code>The p2p-vps-client.js</code> governor application communicates with the Server and
controlls the Docker container.</p></li>
<li><p><code>client-connect.js</code> runs inside the Docker container and establishes the reverse
SSH connection with the server.</p></li>
<li><p>Renters are sandboxed inside the Docker container. They still have access to the
devices' computational power and resources, but their control of the device is limited.
The environment is easy to destroy and recreate.</p></li>
<li><p>Because there is a node application running both inside and outside the Docker
container, and because they can both communicate with the server, secure exchanges
can take place. This means things like encryption keys and passwords can be passed
without ever being written to disk. This allows various forms of on-the-fly encryption,
which is important as anyone with access to the physical device could access the
inside of the Docker container.</p></li>
</ul>
<h2 id="persistentstorageahrefpersistentstorageidpersistentstorageclassdeeplinka">Persistent-Storage <a href="#Persistent-Storage" id="Persistent-Storage" class="deep-link">#</a></h2>
<p>Persistent storage can take many forms, but a USB flash drive will be encouraged,
as SD cards have shown reliability issues. Most IoT devices, like the Raspberry
Pi can boot off an SD card. Extra storage can
easily be accommodated through USB flash drives or even USB external hard drives.
64GB Flash drives will be a (rough) standard due to their availability and low prices.</p>
<p>The <code>flash-storage</code> client has been designed to automatically find, format, and mount
persistent storage.</p>
<h3 id="encryption">Encryption</h3>
<p>Encryption managed by the Device Owner has been explored, but found ineffective.
It will be best to put the responsibility and encryption keys in the hands of the
Renter. Owners will be under no obligation to provide encrypted drives. However,
instructions for setting up LUKS encryption inside the renters Docker container
will be provided by this project.</p>
<ul>
<li><a href="https://launchbylunch.com/posts/2014/Jan/13/encrypting-docker-on-digitalocean/">This is an excellent guide</a>
that can be adapted to encrypt persistent storage in a Docker container.</li>
</ul>
<h2 id="deploymentpackagesahrefdeploymentpackagesiddeploymentpackagesclassdeeplinka">Deployment-Packages <a href="#Deployment-Packages" id="Deployment-Packages" class="deep-link">#</a></h2>
<p>A collection of scripts will be made available to renters. These are
preconfigured shell scripts or some other type of package manager that allows
them to quickly deploy common web services like NextCloud, a blog, a webserver,
a single page application development environment, a TOR node, an OpenBazaar
server, VPN software, etc. Easy scripts to deploy many of
<a href="https://raspberry-hosting.com/en/applications">these use cases</a>.</p>
<p>This project will rely on user contributions or 'corporate sponsorships' for this
section. If interested, please see our <a href="y.Contributing.md">Contributing README</a>
or <a href="http://p2pvps.org/contact-us/">contact us</a>.</p>
<h2 id="testingahreftestingidtestingclassdeeplinka">Testing <a href="#Testing" id="Testing" class="deep-link">#</a></h2>
<p>Unit testing is initially planning to use Mocha, but we could use any platform
at this stage. We could really use help with getting a solid unit testing library
in place for Client software. <a href="http://p2pvps.org/contact-us/">Contact us</a> if you'd
like to help with this effort.</p>
            </div>
        </div>
        <script src="assets_/js/lib/jquery.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shCore.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shAutoloader.js"></script>
        <script src="assets_/js/main.js"></script>
    </body>
</html>

